# 测试用例规划

基于差异分析，以下是针对性的测试用例规划：

## 1. 精度测试用例

### 1.1 位置精度测试
```typescript
describe('位置精度测试', () => {
  it('应该提供高精度的位置坐标', () => {
    // 测试是否保留小数精度而非四舍五入到整数
    // 目标：位置差异 < 1px
  });
  
  it('应该正确处理EMU到点的转换', () => {
    // 验证RATIO_EMUs_Points常量的精确性
    // 测试边界情况下的转换精度
  });
});
```

### 1.2 尺寸精度测试
```typescript
describe('尺寸精度测试', () => {
  it('应该保持尺寸计算的精确性', () => {
    // 测试宽度/高度计算精度
    // 验证文本框、图像、形状的尺寸精度
  });
  
  it('应该处理复杂形状的边界框计算', () => {
    // 测试自定义形状的准确边界框
  });
});
```

## 2. 颜色处理测试用例

### 2.1 颜色格式标准化
```typescript
describe('颜色格式标准化', () => {
  it('应该统一输出颜色格式', () => {
    // 确保所有颜色都使用相同格式（建议rgba）
    // 测试十六进制到rgba的转换
  });
  
  it('应该正确解析主题颜色', () => {
    // 验证dk1, lt1, accent1等主题色的正确映射
    // 测试颜色继承和主题应用
  });
});
```

### 2.2 主题颜色映射测试
```typescript
describe('主题颜色映射', () => {
  it('应该正确提取主题调色板', () => {
    // 验证theme.xml的解析
    // 测试颜色模式转换（RGB, HSL等）
  });
  
  it('应该处理颜色变体和透明度', () => {
    // 测试lumMod, lumOff等颜色变换
    // 验证alpha通道处理
  });
});
```

## 3. ID唯一性测试用例

### 3.1 元素ID生成
```typescript
describe('元素ID唯一性', () => {
  it('应该为每个元素生成唯一ID', () => {
    // 验证所有元素ID的唯一性
    // 测试大量元素情况下ID不冲突
  });
  
  it('应该处理PowerPoint原始ID冲突', () => {
    // 当原文件存在重复ID时的处理策略
    // 测试ID重写和映射逻辑
  });
});
```

### 3.2 ID格式测试
```typescript
describe('ID格式一致性', () => {
  it('应该生成符合预期格式的ID', () => {
    // 验证ID格式（如：字符长度、字符集）
    // 确保与期望输出格式一致
  });
});
```

## 4. 结构对齐测试用例

### 4.1 顶层结构测试
```typescript
describe('输出结构对齐', () => {
  it('应该包含期望的顶层字段', () => {
    // 验证slides, theme, title字段存在
    // 测试slideSize, metadata字段的必要性
  });
  
  it('应该正确提取演示文稿标题', () => {
    // 从文档属性或首页提取title
    // 验证标题内容的准确性
  });
});
```

### 4.2 向后兼容性测试
```typescript
describe('向后兼容性', () => {
  it('应该支持旧版本输出格式', () => {
    // 测试legacy格式兼容
    // 验证position属性映射（left/top vs position.x/y）
  });
});
```

## 5. 边界情况测试用例

### 5.1 特殊元素测试
```typescript
describe('特殊元素处理', () => {
  it('应该正确处理重叠元素', () => {
    // 测试元素层级和Z-index
  });
  
  it('应该处理旋转和变换元素', () => {
    // 验证rotate属性的准确性
    // 测试复杂变换的边界框计算
  });
  
  it('应该处理分组元素', () => {
    // 测试grpSp元素的解析
    // 验证组内元素的相对位置
  });
});
```

### 5.2 内容完整性测试
```typescript
describe('内容完整性验证', () => {
  it('应该保留所有可见元素', () => {
    // 确保没有元素被遗漏
    // 验证隐藏元素的处理策略
  });
  
  it('应该正确处理多语言文本', () => {
    // 测试中文、英文混合内容
    // 验证特殊字符和编码
  });
});
```

## 6. 性能和稳定性测试

### 6.1 性能基准测试
```typescript
describe('性能基准', () => {
  it('应该在合理时间内完成解析', () => {
    // 设置解析时间上限
    // 测试大文件的处理性能
  });
  
  it('应该处理复杂演示文稿', () => {
    // 测试多媒体、动画、图表等复杂内容
  });
});
```

### 6.2 错误处理测试
```typescript
describe('错误处理', () => {
  it('应该优雅处理损坏的PPTX文件', () => {
    // 测试文件损坏时的错误处理
  });
  
  it('应该提供有意义的错误信息', () => {
    // 验证错误消息的质量和可操作性
  });
});
```

## 7. 回归测试用例

### 7.1 现有功能保护
```typescript
describe('回归测试', () => {
  it('应该保持现有测试用例通过', () => {
    // 确保修复不会破坏现有功能
  });
  
  it('应该验证修复后的精确匹配', () => {
    // 针对已识别问题的具体验证
  });
});
```

## 实施优先级

### 高优先级
1. **ID唯一性修复** - 影响元素引用和操作
2. **颜色格式标准化** - 影响主题和样式一致性
3. **结构字段对齐** - 影响API兼容性

### 中优先级
1. **精度提升** - 提升解析质量
2. **错误处理增强** - 提高稳定性

### 低优先级
1. **性能优化** - 当前性能已可接受
2. **边界情况处理** - 覆盖更多使用场景

## 测试实施建议

1. **分阶段实施**: 按优先级分批实施测试用例
2. **自动化集成**: 集成到CI/CD流程中
3. **数据驱动**: 使用多个测试文件验证
4. **持续监控**: 建立性能和质量监控指标